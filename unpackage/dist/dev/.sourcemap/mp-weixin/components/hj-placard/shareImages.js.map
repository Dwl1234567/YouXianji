{"version":3,"sources":["webpack:////Users/0821a/Desktop/project001/app/components/hj-placard/shareImages.vue?7b98","webpack:////Users/0821a/Desktop/project001/app/components/hj-placard/shareImages.vue?b778","webpack:////Users/0821a/Desktop/project001/app/components/hj-placard/shareImages.vue?6fa7","webpack:////Users/0821a/Desktop/project001/app/components/hj-placard/shareImages.vue?1b72","uni-app:///components/hj-placard/shareImages.vue"],"names":["name","props","canvasID","Type","default","canvasWidth","canvasHeight","shareTitle","goodsTitle","shareImage","qrSize","qrUrl","components","QRCode","data","qrCode","mounted","_this","methods","canvasCreate","size","text","then","onCanvas","uni","title","ctx","pic","writeTextOnCanvas","truelen","tlen","nlen","ctx_2d","setTime","setTimeout","resole","getNewPic","canvasId","quality","complete","resolve"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACxH;AAC+D;AACL;;;AAG1D;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAy0B,CAAgB,yyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;ACW71B;AAAA;EAEAA;EACAC;IACA;IACAC;MACAC;MACAC;IACA;IACAC;MAAA;MACAF;MACAC;IACA;IACAE;MAAA;MACAH;MACAC;IACA;IACAG;MAAA;MACAJ;MACAC;IACA;IACAI;MAAA;MACAL;MACAC;IACA;IACAK;MAAA;MACAN;MACAC;IACA;IACAM;MAAA;MACAP;MACAC;IACA;IACAO;MAAA;MACAR;MACAC;IACA;EACA;EACAQ;IACAC;EACA;EACAC;IACA;MACAC;IACA;EACA;EACAC;IACAC;EACA;EACAC;IACA;IACAC;MACAF;QAAAG;QAAAC;MAAA,GACAC;QACA;QACA;QACAL;QACAA;MACA;IACA;IACA;IACAM;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;kBACAC;gBACA;gBACAC,sDACA;gBACAA;gBACAA;gBACAA;gBACA;gBACAA;gBACAA;gBACAA;gBACAA;gBACA;gBACAA;gBACAA;gBACAT;gBACA;gBACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;gBACA;gBACA;gBACA;gBACA;gBACAS;gBACA;gBAAA;gBAAA,OACAT;cAAA;gBAAAU;gBACAV;gBACAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACAW;MACA;MACA;QACA;UAAAC;QACA;UACA;YACAA;UACA;YACAA;UACA;QACA;QACA;MACA;MACA;MACA;QACA;UAAAC;UAAAC;QACA;UACA;YACA;cACAA;YACA;cACAD;cACA;YACA;UACA;YACA;cACAC;YACA;cACAD;cACA;YACA;UACA;QACA;QACA;MACA;MACA;QACA;QACAE;QACAX;MACA;IACA;IACA;IACAY;MACA;QACAC;UACAR;YAAA;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,OACAT;kBAAA;oBAAAU;oBACAQ;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA,CACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACAF;UACAV;YACAa;YACAC;YACAC;cACA;cACA;cACAf;cACA;cACAgB;YACA;UACA;QACA;MACA;IACA;EACA;AAAA,iCACA;EACAvB;AACA;AAAA,2B","file":"components/hj-placard/shareImages.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./shareImages.vue?vue&type=template&id=30a52b4d&\"\nvar renderjs\nimport script from \"./shareImages.vue?vue&type=script&lang=js&\"\nexport * from \"./shareImages.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/hj-placard/shareImages.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=template&id=30a52b4d&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=script&lang=js&\"","<template>\n\t<view style=\"position: fixed;z-index: -9999;\">\n\t\t<canvas :canvas-id=\"canvasID\" :style=\"{width:canvasWidth+'px',height:canvasHeight+'px'}\"></canvas>\n\t\t<view v-if=\"qrCode == ''\">\n\t\t\t<QRCode ref=\"qrcode\" />\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport QRCode from \"../qr_code/qrcode.vue\"\n\tvar _this;\n\texport default {\n\t\tname: 'canvas-images',\n\t\tprops: {\n\t\t\t// canvasID 等同于 canvas-id\n\t\t\tcanvasID: {\n\t\t\t\tType: String,\n\t\t\t\tdefault: 'shareCanvas'\n\t\t\t},\n\t\t\tcanvasWidth:{\t// 画布宽度\n\t\t\t\tType: 'int',\n\t\t\t\tdefault: 750\n\t\t\t},\n\t\t\tcanvasHeight:{\t// 画布高度\n\t\t\t\tType: 'int',\n\t\t\t\tdefault: 1333\n\t\t\t},\n\t\t\tshareTitle:{\t// 分享标题\n\t\t\t\tType: 'String',\n\t\t\t\tdefault: '我是这张图片的标题'\n\t\t\t},\n\t\t\tgoodsTitle:{\t// 商品宣传标题\n\t\t\t\tType: 'String',\n\t\t\t\tdefault: '我是这张图片的标题我是这张图片的标题我是这张图片的标'\n\t\t\t},\n\t\t\tshareImage:{\t// 分享图片\n\t\t\t\tType: 'String',\n\t\t\t\tdefault: '@/static/item/bg.jpg'\n\t\t\t},\n\t\t\tqrSize:{\t// 二维码大小\n\t\t\t\tType: 'int',\n\t\t\t\tdefault: 300\n\t\t\t},\n\t\t\tqrUrl:{\t\t// 生成二维码的链接\n\t\t\t\tType: 'String',\n\t\t\t\tdefault: 'https://ext.dcloud.net.cn/plugin?id=5747'\n\t\t\t}\n\t\t},\n\t\tcomponents:{\n\t\t\tQRCode\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tqrCode:'',\t// 二维码\n\t\t\t}\n\t\t},\n\t\tmounted(){\n\t\t\t_this = this;\n\t\t},\n\t\tmethods: {\n\t\t\t// 创建二维码\n\t\t\tcanvasCreate(){\n\t\t\t\t_this.$refs.qrcode.make({size: _this.qrSize,text: _this.qrUrl})\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t// 返回的res与uni.canvasToTempFilePath返回一致\n\t\t\t\t\t\t// console.log(res)\n\t\t\t\t\t\t_this.qrCode = res.tempFilePath;\n\t\t\t\t\t\t_this.onCanvas();\n\t\t\t\t\t});\n\t\t\t},\n\t\t\t// 画图\n\t\t\tasync onCanvas() {\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: \"分享图片生成中...\"\n\t\t\t\t});\n\t\t\t\tconst ctx = uni.createCanvasContext(_this.canvasID, _this);\n\t\t\t\t// 设置 canvas 背景色\n\t\t\t\tctx.setFillStyle('#FFFFFF');\n\t\t\t\tctx.fillRect(0, 0, _this.canvasWidth, _this.canvasHeight);\n\t\t\t\tctx.setFillStyle('#000000');\n\t\t\t\t// 背景图片\n\t\t\t\tctx.drawImage(_this.shareImage,0,0,_this.canvasWidth, _this.canvasHeight);\n\t\t\t\tctx.setFontSize(18);\n\t\t\t\tctx.setTextAlign('center');\n\t\t\t\tctx.fillText(_this.shareTitle, _this.canvasWidth/2, 30);\n\t\t\t\t// 左边标题\n\t\t\t\tctx.setTextAlign('left')\n\t\t\t\tctx.setFontSize(16)\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21,_this.goodsTitle,50,350);\n\t\t\t\t// 设置虚线\n\t\t\t\t/*\n\t\t\t\tctx.setStrokeStyle('#333333');\n\t\t\t\tctx.setLineDash([5, 10], 2);\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(220,340);\n\t\t\t\tctx.lineTo(220,420);\n\t\t\t\tctx.stroke();\n\t\t\t\t*/\n\t\t\t\t// 二维码\n\t\t\t\t//ctx.drawImage(_this.qrCode,_this.canvasWidth/2 - (_this.canvasWidth*0.2/2),_this.canvasHeight - 150,_this.canvasWidth*0.2,_this.canvasWidth*0.2);\n\t\t\t\t//ctx.drawImage(_this.qrCode,_this.canvasWidth/2 - 50,_this.canvasHeight - 220,100,100);\n\t\t\t\t// ctx.draw();\n\t\t\t\tctx.drawImage(_this.qrCode,_this.canvasWidth/2 - (_this.canvasWidth*0.2/2+15),_this.canvasHeight/2+145,_this.canvasWidth*0.3,_this.canvasWidth*0.3);\n\t\t\t\t// 延迟后渲染至canvas上\n\t\t\t\tlet pic = await _this.setTime(ctx)\n\t\t\t\t_this.$emit('success', pic);\n\t\t\t\t_this.qr_code = '';\n\t\t\t},\n\t\t\t/**\n\t\t\t * @param {Object} ctx_2d\tgetContext(\"2d\") 对象\n\t\t\t * @param {int} lineheight\t段落文本行高\n\t\t\t * @param {int} bytelength\t设置单字节文字一行内的数量\n\t\t\t * @param {string} text\t\t写入画面的段落文本\n\t\t\t * @param {int} startleft\t开始绘制文本的 x 坐标位置（相对于画布）\n\t\t\t * @param {int} starttop\t开始绘制文本的 y 坐标位置（相对于画布）\n\t\t\t */\n\t\t\twriteTextOnCanvas(ctx_2d, lineheight, bytelength, text ,startleft, starttop){\n\t\t\t\t// 获取字符串的真实长度（字节长度）\n\t\t\t\tfunction getTrueLength(str){\n\t\t\t\t\tvar len = str.length, truelen = 0;\n\t\t\t\t\tfor(var x = 0; x < len; x++){\n\t\t\t\t\t\tif(str.charCodeAt(x) > 128){\n\t\t\t\t\t\t\ttruelen += 2;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\ttruelen += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn truelen;\n\t\t\t\t}\n\t\t\t\t// 按字节长度截取字符串，返回substr截取位置\n\t\t\t\tfunction cutString(str, leng){\n\t\t\t\t\tvar len = str.length, tlen = len, nlen = 0;\n\t\t\t\t\tfor(var x = 0; x < len; x++){\n\t\t\t\t\t\tif(str.charCodeAt(x) > 128){\n\t\t\t\t\t\t\tif(nlen + 2 < leng){\n\t\t\t\t\t\t\t\tnlen += 2;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\ttlen = x;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tif(nlen + 1 < leng){\n\t\t\t\t\t\t\t\tnlen += 1;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\ttlen = x;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn tlen;\n\t\t\t\t}\n\t\t\t\tfor(var i = 1; getTrueLength(text) > 0; i++){\n\t\t\t\t\tvar tl = cutString(text, bytelength);\n\t\t\t\t\tctx_2d.fillText(text.substr(0, tl).replace(/^\\s+|\\s+$/, \"\"), startleft, (i-1) * lineheight + starttop);\n\t\t\t\t\ttext = text.substr(tl);\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 彻底改成同步 防止拿到的图片地址为空\n\t\t\tsetTime(ctx) {\n\t\t\t\treturn new Promise((resole, err) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tctx.draw(false, async () => {\n\t\t\t\t\t\t\tlet pic = await _this.getNewPic();\n\t\t\t\t\t\t\tresole(pic)\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 600)\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 获取新的图片地址\n\t\t\tgetNewPic() {\n\t\t\t\treturn new Promise((resolve, errs) => {\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\t\t\tcanvasId: _this.canvasID,\n\t\t\t\t\t\t\tquality: 1,\n\t\t\t\t\t\t\tcomplete: (res) => {\n\t\t\t\t\t\t\t\t// 在H5平台下，tempFilePath 为 base64\n\t\t\t\t\t\t\t\t// 关闭showLoading\n\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t\t//  储存海报地址  也是分享的地址\n\t\t\t\t\t\t\t\tresolve(res.tempFilePath)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, _this);\n\t\t\t\t\t},200)\n\t\t\t\t})\n\t\t\t},\n\t\t},\n\t\tmounted() {\n\t\t\t_this = this;\n\t\t}\n\t}\n</script>"],"sourceRoot":""}